<div class="layui-field-box">
	<form class="layui-form layui-form-pane1" action="">
		<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
			<ul class="layui-tab-title">
				<li class="layui-this" @click="click_base()">基本信息</li>					
				<li @click="click_domain()">域名信息</li>
			</ul>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show">
					<div class="layui-form-item">
						<label class="layui-form-label">app名称:</label>
						<div class="layui-input-block">
							<input type="text" name="name" lay-verify='required' value="{$app_info['name']|default=''}" required placeholder="" autocomplete="off" class="layui-input">
							<span class="remark"></span>
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">描述:</label>
						<div class="layui-input-block">
							<input type="text" name="describe" value="{$app_info['describe']|default=''}" required placeholder="" autocomplete="off" class="layui-input">
							<span class="remark"></span>
						</div>
					</div>
					
					<div class="layui-form-item">
						<label class="layui-form-label">版本:</label>
						<div class="layui-input-block">
							<input type="text" name="version" value="{$app_info['version']|default=''}" required placeholder="" autocomplete="off" class="layui-input">
							<span class="remark"></span>
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">排序:</label>
						<div class="layui-input-block">
							<input type="text" name="sort" value="{$app_info['sort']|default='100'}" required placeholder="" autocomplete="off" class="layui-input">
							<span class="remark"></span>
						</div>
					</div>					
				</div>
				<div class="layui-tab-item">
					<div class="layui-form-item" v-for="(domain,index) in domain_array">
						<label class="layui-form-label">域名{{index+1}}:</label>
						<div class="layui-input-block" style="padding-right: 70px;">
							<input type="text" v-model="domain_array[index]" required placeholder="如 http://www.api.com" autocomplete="off" class="layui-input">
							<div class="layui-btn layui-btn-primary" style="position: absolute; right: 0; top: 0;" @click="del_domain(index)"><i class="layui-icon" style="">&#x1006;</i></div>
							<span class="remark"></span>
						</div>
					</div>
				</div>				
			</div>
		</div> 
		<div class="layui-form-item">
			<div class="layui-input-block">
				<button class="layui-btn" lay-submit lay-filter="*">提交</button>
				<div v-if="form_content=='domain'" class="layui-btn layui-btn-primary" @click="add_domain()">添加域名</div>
			</div>
		</div>
	</form>
</div>

<script>
var vue = new Vue({
	el:'.layui-form',
	data:{
		form_content:'base',
		domain_array:new Array(),
		test:'test',
		app_info:JSON.parse('{:json_encode(@$app_info)}'),
	},
	methods:{
		click_base:function(){
			vue.form_content = 'base';
		},
		click_domain:function(){	
			if(vue.domain_array.length == 0){
				this.domain_array.push('http://');
			}
			vue.form_content = 'domain';
		},
		//添加域名
		add_domain:function(){
			this.domain_array.push('http://');
		},
		del_domain:function(index){
			this.domain_array.splice(index,1);
		},
		
	},
	mounted:function(){
		if(this.app_info){
			var domain_array = this.app_info.domain.split(',');
			domain_array.pop();
			this.domain_array = domain_array;
		}
		//this.domain_array.push('http://');
	}
});

layui.use(['form','element'], function(){	
	var form = layui.form;

	//自定义验证规则
	form.verify({
		title: function(value){
		  	if(value.length < 5){
		    	return '标题也太短了吧';
		  	}
		}
		,pass: [/(.+){6,12}$/, '密码必须6到12位']
	});


	//事件监听
	form.on('select', function(data){
		console.log(data);
	});

	form.on('select(aihao)', function(data){
		console.log(data);
	});

	form.on('checkbox', function(data){
		console.log(data.elem.checked);
	});

	form.on('switch', function(data){
		console.log(data);
	});

	form.on('radio', function(data){
		console.log(data);
	});

	//监听提交
	form.on('submit(*)', function(data){
		var field = data.field;
		var url = "{:url('',input('param.'))}";

		if(vue.domain_array.length == 0){
			layer.msg('请至少设置一个api域名');
			return false;
		}

		var domain_string = '';
		for(var i in vue.domain_array){
			domain_string += vue.domain_array[i]+',';
		}
		field.domain = domain_string;
				
		//post(field,url);
		var obj = data.elem;
		$intop.post(obj,url,field,function(ret){
			if(ret.success == true){			
				parent.layer.msg(ret.msg);	
				parent.vue.app_list = ret.data.data;
				var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
				parent.layer.close(index); //再执行关闭 
			}else{
				layer.msg(ret.msg);
			}			
		});

		return false;
	});
  
});

</script>